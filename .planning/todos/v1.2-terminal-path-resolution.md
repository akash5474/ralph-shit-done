# v1.2: Terminal Path Resolution Bug

## Priority: Critical (blocks autopilot on Windows)

## Problem Summary

When `wt.exe` (Windows Terminal) spawns bash, the path format used is incorrect, causing `cd: /c/Users/...: No such file or directory` errors.

## Root Cause Analysis

**The core issue:** We don't know which bash `wt.exe` will spawn - it depends on the user's Windows Terminal default profile configuration.

| Bash Type | Path Format | Example |
|-----------|-------------|---------|
| Git Bash | `/c/Users/...` | `/c/Users/Jameson/Downloads/project` |
| WSL bash | `/mnt/c/Users/...` | `/mnt/c/Users/Jameson/Downloads/project` |
| Cygwin bash | `/cygdrive/c/Users/...` | `/cygdrive/c/Users/Jameson/Downloads/project` |
| Native Windows bash | `C:/Users/...` | `C:/Users/Jameson/Downloads/project` |

**Current behavior:** We assume Git Bash format (`/c/Users/...`), but if the user's default Windows Terminal profile is WSL, the path doesn't exist.

## Failed Attempts

1. **Windows paths (`C:/Users/...`)** - Git Bash doesn't understand this
2. **Git Bash paths (`/c/Users/...`)** - WSL bash doesn't understand this
3. **Using wt.exe `-d` flag** - Sets working directory but script path still needs correct format

## Symptoms

```
/bin/bash: line 1: cd: /c/Users/Jameson/Downloads/gsd-auto-pilot-test: No such file or directory
```

The `/bin/bash` in the error suggests WSL bash (Git Bash would show `/usr/bin/bash`).

## Proposed Solutions

### Option A: Detect bash type before launching

```javascript
// Run a test command to detect which bash is being used
const result = execSync('bash -c "echo $OSTYPE"').toString().trim();
// msys = Git Bash, linux-gnu = WSL, cygwin = Cygwin
```

Then use appropriate path format based on detection.

### Option B: Use Windows path and let bash translate

Some bash implementations can translate Windows paths automatically when using certain invocation methods.

### Option C: Specify profile explicitly in wt.exe

```javascript
spawn('wt.exe', ['-p', 'Git Bash', ...])  // Force specific profile
```

Requires knowing the profile name, which varies by user.

### Option D: Don't use wt.exe bash - use cmd.exe or PowerShell

Fall back to `cmd.exe` which reliably spawns Git Bash:
```javascript
spawn('cmd.exe', ['/c', 'start', 'bash', '--login', '-c', '...'])
```

### Option E: Universal path resolution at runtime

Pass Windows path and resolve inside the bash command:
```bash
# Let bash figure out the path
cd "$(cygpath -u 'C:\Users\Jameson\Downloads\project')" 2>/dev/null || \
cd "/mnt/c/Users/Jameson/Downloads/project" 2>/dev/null || \
cd "/c/Users/Jameson/Downloads/project" 2>/dev/null || \
cd "C:/Users/Jameson/Downloads/project"
```

## Recommended Approach

**Option D (fallback to cmd.exe)** is the most reliable:

1. Remove wt.exe from the priority list OR
2. Change wt.exe launcher to spawn cmd.exe with bash inside

This ensures Git Bash is always used consistently.

**Option E (runtime resolution)** is the most robust but adds complexity.

## Files to Modify

- `bin/lib/terminal-launcher.js` - Path handling and launcher functions

## Testing Matrix

After fix, test on:
- [ ] Windows Terminal with Git Bash as default profile
- [ ] Windows Terminal with WSL as default profile
- [ ] Windows Terminal with PowerShell as default profile
- [ ] Plain cmd.exe
- [ ] Plain PowerShell

## Related

- Previous fix attempts in commits: `307cb70`, `8502138`, `82ae4c1`, `538155e`
- Original bug: `.planning/todos/bug-ralph-path-resolution.md` (deleted, was for different issue)

---
*Created: 2026-01-21*
*Blocking: Autopilot terminal launch on Windows with non-Git-Bash default profile*
